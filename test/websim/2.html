
<html><head><base href=".">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>&#x667a;&#x6167;&#x517b;&#x751f;&#x4e4b;&#x95e8;&#xff1a;&#x4e2d;&#x533b;&#x667a;&#x80fd;&#x5316;&#x63a2;&#x9669;</title>
<style>
*, *::before, *::after { 
    box-sizing: border-box; 
    margin: 0; 
    padding: 0; 
}

body {
    font-family: "Microsoft YaHei", "微软雅黑", sans-serif;
    background: linear-gradient(135deg, #1a1a2e, #162447);
    color: #fff;
    min-height: 100vh;
    padding: 2rem;
}

.game-container {
    max-width: 1200px;
    margin: 2rem auto;
    min-height: 80vh;
    position: relative;
    padding: 2rem;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="rgba(0,0,0,0.5)"/><path d="M0 50 L100 50 M50 0 L50 100" stroke="rgba(255,255,255,0.1)" stroke-width="1"/></svg>') repeat;
}

.story-section {
    background-size: cover;
    background-position: center;
    transition: all 0.8s ease;
    position: relative;
    overflow: hidden;
    background: rgba(0, 0, 0, 0.8);
    border: 2px solid rgba(255, 255, 255, 0.2);
    padding: 2rem;
    margin: 2rem auto;
    border-radius: 10px;
}

.story-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.6) 100%);
    z-index: 0;
}

.story-text {
    position: relative;
    z-index: 1;
    font-size: 1.6rem;
    line-height: 1.8;
    padding: 2rem;
    background: rgba(0,0,0,0.7);
    border-radius: 15px;
    margin-bottom: 2rem;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
}

.option-btn {
    position: relative;
    z-index: 1;
    transform-origin: center; /* Changed from left center */
    padding: 2rem;
    margin: 1.5rem auto; /* Changed from 1.5rem 0 to center horizontally */
    font-size: 1.4rem;
    border-left: 5px solid #00ff87;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    width: 80%; /* Added width */
    max-width: 800px; /* Added max-width */
    display: block; /* Added display block */
}

.option-btn:hover {
    background: rgba(0,255,135,0.2);
    transform: scale(1.02); /* Changed from translateX(30px) scale(1.02) */
}

.options {
    margin-top: 2rem;
    display: flex;
    flex-direction: column;
    align-items: center; /* Added to center options */
    width: 100%; /* Added width */
}

.scene-enter {
    opacity: 0;
    transform: translateY(50px);
}

.scene-exit-active {
    opacity: 0;
    transform: translateY(-50px);
    transition: all 0.8s ease;
}

.result {
    font-size: 1.4rem;
    padding: 1.5rem;
    background: rgba(0,255,135,0.3);
    border-left: 5px solid #00ff87;
}

.scene-pattern {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    opacity: 0.1;
    pointer-events: none;
    background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.4'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
}

.inventory {
    position: fixed;
    right: 20px;
    bottom: 20px;
    background: rgba(0, 0, 0, 0.9);
    padding: 1.5rem;
    border-radius: 10px;
    max-width: 300px;
    border: 2px solid rgba(0, 255, 135, 0.3);
    backdrop-filter: blur(10px);
    box-shadow: 0 0 20px rgba(0, 255, 135, 0.2);
    transform: translateZ(0);
    z-index: 1000;
}

.inventory-items {
    max-height: 200px;
    overflow-y: auto;
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.5rem;
    padding-right: 0.5rem;
}

.inventory-item {
  padding: 0.8rem;
  margin: 0.5rem;
  background: rgba(0, 255, 135, 0.1);
  border: 1px solid rgba(0, 255, 135, 0.3);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  animation: floatingItem 3s ease-in-out infinite;
  position: relative;
}

@keyframes floatingItem {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-5px); }
}

.inventory-item:hover {
  background: rgba(0, 255, 135, 0.2);
  transform: scale(1.05) translateY(-2px);
  box-shadow: 0 5px 15px rgba(0, 255, 135, 0.2);
}

.inventory h3 {
    margin-bottom: 0.8rem;
    font-size: 1.1rem;
}

.item-tooltip {
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    margin-bottom: 10px;
    position: absolute;
    background: rgba(0, 0, 0, 0.9);
    border: 1px solid rgba(0, 255, 135, 0.5);
    padding: 1rem;
    border-radius: 8px;
    font-size: 0.9rem;
    max-width: 250px;
    z-index: 1001;
    pointer-events: none;
    animation: tooltipFadeIn 0.3s ease;
}

@keyframes tooltipFadeIn {
    from { opacity: 0; transform: translateX(-10px); }
    to { opacity: 1; transform: translateX(0); }
}

.progress-container {
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(255, 255, 255, 0.1);
    padding: 1rem;
    border-radius: 10px;
    z-index: 100;
}

.progress-bar {
    width: 200px;
    height: 10px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 5px;
    overflow: hidden;
}

.progress {
    width: 0%;
    height: 100%;
    background: linear-gradient(90deg, #00ff87, #60efff);
    transition: width 0.3s ease;
}

.current-level {
    text-align: center;
    margin-top: 0.5rem;
    font-size: 0.9rem;
}

.game-header {
    text-align: center;
    margin-bottom: 2rem;
}

.game-title {
    font-size: 2.5rem;
    color: #00ff87;
    text-shadow: 0 0 10px rgba(0,255,135,0.5);
    margin-bottom: 1rem;
}

.stats-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: rgba(255, 255, 255, 0.1);
    padding: 1rem;
    border-radius: 10px;
    text-align: center;
}

.stat-value {
    font-size: 1.5rem;
    color: #00ff87;
}

.stat-label {
    font-size: 0.9rem;
    opacity: 0.8;
}

.game-over {
    text-align: center;
    padding: 2rem;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    margin-top: 2rem;
    display: none;
}

.game-over h2 {
    color: #00ff87;
    margin-bottom: 1rem;
}

.achievement {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 255, 135, 0.2);
    padding: 2rem;
    border-radius: 15px;
    text-align: center;
    display: none;
    animation: achievementPop 0.5s ease-out;
    z-index: 1100;
    border: 2px solid #00ff87;
    box-shadow: 0 0 20px rgba(0, 255, 135, 0.3);
}

@keyframes achievementPop {
    0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
    100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
}

.result {
    position: absolute;
    bottom: 1rem;
    right: 1rem;
    background: rgba(0, 255, 135, 0.2);
    padding: 1rem;
    border-radius: 8px;
    animation: fadeIn 0.5s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.dialog-box {
    position: relative;
    background: rgba(0, 0, 0, 0.85);
    border: 2px solid #00ff87;
    padding: 2rem;
    margin: 1rem auto;
    border-radius: 15px;
    box-shadow: 0 0 20px rgba(0, 255, 135, 0.2);
    animation: dialogFadeIn 0.5s ease;
}

.character-name {
    position: absolute;
    top: -1.5rem;
    left: 2rem;
    background: #00ff87;
    color: #000;
    padding: 0.5rem 1.5rem;
    border-radius: 20px;
    font-weight: bold;
}

.dialog-text {
    font-size: 1.4rem;
    line-height: 1.8;
    color: #fff;
    text-shadow: 0 0 5px rgba(0, 255, 135, 0.5);
}

@keyframes dialogFadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.typing-cursor {
    display: inline-block;
    width: 3px;
    height: 1.4rem;
    background: #00ff87;
    margin-left: 2px;
    animation: blink 0.7s infinite;
}

@keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
}

.scene-transition {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: black;
    z-index: 1000;
    transform-origin: left;
    animation: sceneTransition 1.5s ease-in-out;
}

@keyframes sceneTransition {
    0% { transform: scaleX(0); }
    50% { transform: scaleX(1); }
    100% { transform: scaleX(0); }
}

.choice-hover-effect {
    transition: all 0.3s ease;
    transform-origin: left;
}

.choice-hover-effect:hover {
    transform: scale(1.05) translateX(20px);
    background: rgba(0, 255, 135, 0.3);
    box-shadow: 0 0 20px rgba(0, 255, 135, 0.4);
}

.notification {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 255, 135, 0.2);
    border: 2px solid #00ff87;
    padding: 1rem 2rem;
    border-radius: 20px;
    color: #fff;
    font-size: 1.2rem;
    z-index: 1000;
    animation: notificationFadeIn 0.5s ease;
}

@keyframes notificationFadeIn {
    from { opacity: 0; transform: translate(-50%, -20px); }
    to { opacity: 1; transform: translate(-50%, 0); }
}

.fade-out {
    opacity: 0;
    transform: translate(-50%, -20px);
    transition: all 0.5s ease;
}

.audio-controls {
    position: fixed;
    top: 20px;
    left: 20px;
    background: rgba(0, 0, 0, 0.9);
    padding: 1rem;
    border-radius: 10px;
    z-index: 100;
}

.sound-btn {
    width: 30px;
    height: 30px;
    border: none;
    background: none;
    cursor: pointer;
}

.sound-btn svg {
    fill: #00ff87;
    width: 24px;
    height: 24px;
}

.game-menu-toggle {
    position: fixed;
    top: 20px;
    left: 20px;
    background: rgba(0, 0, 0, 0.8);
    border: 2px solid rgba(0, 255, 135, 0.3);
    border-radius: 50%;
    width: 50px;
    height: 50px;
    cursor: pointer;
    z-index: 1100;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.game-menu-toggle:hover {
    transform: scale(1.1);
    background: rgba(0, 255, 135, 0.2);
}

.game-menu-toggle svg {
    width: 30px;
    height: 30px;
    fill: #00ff87;
}

.game-menu {
    position: fixed;
    top: 80px;
    left: 20px;
    background: rgba(0, 0, 0, 0.9);
    border: 2px solid rgba(0, 255, 135, 0.3);
    border-radius: 10px;
    padding: 1rem;
    z-index: 1100;
    transform: translateX(-120%);
    transition: transform 0.3s ease;
    backdrop-filter: blur(10px);
    min-width: 200px;
}

.game-menu.active {
    transform: translateX(0);
}

.menu-item {
    display: flex;
    align-items: center;
    padding: 1rem 1.5rem;
    margin: 0.8rem 0;
    cursor: pointer;
    border-radius: 8px;
    transition: all 0.3s ease;
    color: #fff;
    text-decoration: none;
}

.menu-item:hover {
    background: rgba(0, 255, 135, 0.2);
    transform: translateX(10px);
}

.menu-item svg {
    width: 20px;
    height: 20px;
    margin-right: 10px;
    fill: #00ff87;
}

.achievements-submenu {
    margin-top: 10px;
    padding: 15px;
    background: rgba(0, 0, 0, 0.95);
    border-radius: 12px;
    border: 1px solid rgba(0, 255, 135, 0.3);
    max-height: 300px;
    overflow-y: auto;
}

.achievements-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.achievement-list-item {
    background: rgba(0, 255, 135, 0.1);
    padding: 15px;
    border-radius: 8px;
    border: 1px solid rgba(0, 255, 135, 0.3);
    transition: all 0.3s ease;
    position: relative;
    display: flex;
    align-items: center;
    gap: 10px;
}

.achievement-list-item::before {
    content: '🏆';
    font-size: 1.2em;
}

.achievement-list-item:hover {
    background: rgba(0, 255, 135, 0.2);
    transform: translateX(5px);
    box-shadow: 0 0 15px rgba(0, 255, 135, 0.2);
}

.achievement-list-empty {
    text-align: center;
    padding: 20px;
    color: rgba(255, 255, 255, 0.6);
    font-style: italic;
}

.achievements-submenu::-webkit-scrollbar {
    width: 8px;
}

.achievements-submenu::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 4px;
}

.achievements-submenu::-webkit-scrollbar-thumb {
    background: rgba(0, 255, 135, 0.3);
    border-radius: 4px;
}

.achievements-submenu::-webkit-scrollbar-thumb:hover {
    background: rgba(0, 255, 135, 0.5);
}

.achievement-category {
  margin-bottom: 1.5rem;
}

.achievement-category h3 {
  color: #00ff87;
  margin-bottom: 1rem;
  padding-bottom: 0.5rem;
  border-bottom: 1px solid rgba(0, 255, 135, 0.3);
}

.achievement-list-item.inventory-item {
  background: rgba(0, 255, 135, 0.05);
}

.achievement-list-item.inventory-item:hover {
  background: rgba(0, 255, 135, 0.1);
}

.inventory-item .item-description {
  display: block;
  font-size: 0.8em;
  color: rgba(255, 255, 255, 0.7);
  margin-top: 0.5rem;
}

.story-progress {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.8);
    padding: 1rem 2rem;
    border-radius: 20px;
    border: 2px solid rgba(0, 255, 135, 0.3);
    z-index: 100;
    display: flex;
    align-items: center;
}

.story-progress-bar {
    width: 200px;
    height: 6px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
    overflow: hidden;
}

.story-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #00ff87, #60efff);
    width: 0%;
    transition: width 0.5s ease;
}

.scene-transition-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: black;
    z-index: 1000;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s ease;
}

.scene-transition-active {
    opacity: 1;
    pointer-events: auto;
}

.background-transition {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: black;
    z-index: 999;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s ease;
}

.background-transition.active {
    opacity: 1;
    pointer-events: auto;
}

.particle-container {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    z-index: 1;
}

.start-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #1a1a2e, #162447);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 2000;
}

.start-content {
    text-align: center;
    padding: 2rem;
    background: rgba(0, 0, 0, 0.8);
    border: 2px solid #00ff87;
    border-radius: 15px;
    animation: fadeIn 1s ease;
}

.start-description {
    text-align: left;
    margin: 2rem 0;
    padding: 2rem;
    background: rgba(0, 0, 0, 0.7);
    border-radius: 15px;
    border: 1px solid rgba(0, 255, 135, 0.3);
}

.start-description ul {
    list-style: none;
    padding: 1rem 0;
}

.start-description li {
    margin: 1rem 0;
    padding-left: 1rem;
    border-left: 3px solid #00ff87;
    transition: all 0.3s ease;
}

.start-description li:hover {
    transform: translateX(10px);
    background: rgba(0, 255, 135, 0.1);
    padding: 0.5rem 1rem;
    border-radius: 5px;
}

.start-description p {
    margin: 1rem 0;
    line-height: 1.6;
    color: #fff;
    text-shadow: 0 0 5px rgba(0, 255, 135, 0.5);
}

.start-btn {
    margin-top: 2rem;
    padding: 1rem 3rem;
    font-size: 1.5rem;
    background: rgba(0, 255, 135, 0.2);
    border: 2px solid #00ff87;
    color: #fff;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.start-btn:hover {
    background: rgba(0, 255, 135, 0.4);
    transform: translateY(-2px);
}

.character-portrait {
    position: fixed;
    bottom: 20px;
    left: 20px;
    width: 200px;
    height: 300px;
    background: rgba(0, 0, 0, 0.8);
    border: 2px solid #00ff87;
    border-radius: 10px;
    overflow: hidden;
    transition: all 0.3s ease;
}

.character-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    opacity: 0.8;
}

.achievement-toast {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: rgba(0, 255, 135, 0.2);
  border: 2px solid #00ff87;
  padding: 1rem 2rem;
  border-radius: 10px;
  color: #fff;
  font-size: 1.2rem;
  z-index: 1000;
  animation: toastFadeIn 0.5s ease;
  backdrop-filter: blur(5px);
  box-shadow: 0 0 20px rgba(0, 255, 135, 0.2);
}

@keyframes toastFadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

.toast-fade-out {
  opacity: 0;
  transform: translateY(20px);
  transition: all 0.5s ease;
}

.analysis-container {
  background: rgba(0, 0, 0, 0.9);
  padding: 2rem;
  border-radius: 15px;
  border: 2px solid #00ff87;
  margin-top: 2rem;
  animation: fadeIn 0.5s ease;
}

.analysis-title {
  color: #00ff87;
  font-size: 1.8rem;
  margin-bottom: 1rem;
  text-align: center;
}

.analysis-text {
  font-size: 1.4rem;
  line-height: 1.6;
  margin-bottom: 1rem;
  padding: 1rem;
  border-left: 4px solid #00ff87;
  background: rgba(0, 255, 135, 0.1);
}

.analysis-score {
  font-size: 2rem;
  color: #00ff87;
  text-align: center;
  margin: 2rem 0;
}

.roast-text {
  font-style: italic;
  color: #ff6b6b;
  padding: 1rem;
  border-radius: 8px;
  background: rgba(255, 107, 107, 0.1);
  margin-top: 1rem;
}

.achievement-category {
  margin-bottom: 2.5rem;
  padding: 1.5rem;
  background: rgba(0, 0, 0, 0.4);
  border-radius: 12px;
  border: 1px solid rgba(0, 255, 135, 0.3);
}

.achievement-category h3 {
  color: #00ff87;
  font-size: 1.4rem;
  margin-bottom: 1rem;
  padding-bottom: 0.5rem;
  border-bottom: 2px solid rgba(0, 255, 135, 0.3);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.achievement-category-description {
  color: rgba(255, 255, 255, 0.7);
  font-size: 0.9rem;
  margin-bottom: 1.5rem;
  padding: 0.5rem;
  border-left: 3px solid rgba(0, 255, 135, 0.3);
  background: rgba(0, 255, 135, 0.1);
}

.achievement-list-item {
  margin-bottom: 1rem;
  padding: 1.2rem;
  background: rgba(0, 0, 0, 0.6);
  border-radius: 8px;
  border: 1px solid rgba(0, 255, 135, 0.2);
  transition: all 0.3s ease;
}

.achievement-list-item:hover {
  transform: translateX(10px);
  background: rgba(0, 255, 135, 0.1);
  border-color: rgba(0, 255, 135, 0.4);
}

.item-header, .achievement-header {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 0.8rem;
}

.achievement-icon {
  font-size: 1.4rem;
}

.achievement-title {
  font-size: 1.1rem;
  color: #00ff87;
}

.item-details, .achievement-details {
  margin-left: 2.4rem;
  padding-left: 1rem;
  border-left: 2px solid rgba(0, 255, 135, 0.2);
}

.item-description, .achievement-description {
  color: rgba(255, 255, 255, 0.9);
  margin-bottom: 0.5rem;
  line-height: 1.4;
}

.item-rarity, .item-acquisition, .achievement-date {
  display: block;
  font-size: 0.8rem;
  color: rgba(255, 255, 255, 0.6);
  margin-top: 0.3rem;
}

.achievement-list-empty {
  text-align: center;
  padding: 3rem 2rem;
  background: rgba(0, 0, 0, 0.4);
  border-radius: 12px;
  border: 1px solid rgba(0, 255, 135, 0.2);
}

.empty-icon {
  font-size: 3rem;
  margin-bottom: 1rem;
  opacity: 0.7;
}

.achievement-list-empty h3 {
  color: #00ff87;
  margin-bottom: 1rem;
}

.achievement-list-empty p {
  color: rgba(255, 255, 255, 0.7);
  line-height: 1.6;
}

.qr-code-section {
  margin-top: 2rem;
  text-align: center;
  background: rgba(0, 0, 0, 0.4);
  padding: 2rem;
  border-radius: 12px;
  border: 1px solid rgba(0, 255, 135, 0.3);
}

.qr-code-section h3 {
  color: #00ff87;
  margin-bottom: 1rem;
}

.qr-code-section p {
  color: rgba(255, 255, 255, 0.9);
  margin-bottom: 1rem;
}

.qr-code-container {
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 1rem auto;
  width: 200px;
  height: 200px;
  background: white;
  padding: 1rem;
  border-radius: 8px;
}

.qr-code {
  width: 100%;
  height: 100%;
}

.loading-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #1a1a2e, #162447);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 2500;
}

.loading-bar {
  width: 300px;
  height: 10px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 5px;
  overflow: hidden;
  margin: 20px 0;
}

.loading-progress {
  width: 0%;
  height: 100%;
  background: linear-gradient(90deg, #00ff87, #60efff);
  transition: width 0.5s ease;
}

.loading-text {
  color: #00ff87;
  font-size: 1.2rem;
  margin-top: 10px;
}
</style>
</head>
<body>
<div id="achievement" class="achievement" style="display: none;">
    <h3>&#x6210;&#x5c31;&#x89e3;&#x9501;&#xff01;</h3>
    <p id="achievementText"></p>
</div>
<div class="game-menu-toggle" id="menuToggle">
    <svg viewBox="0 0 24 24">
        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
    </svg>
</div>

<div class="game-menu" id="gameMenu">
    <div class="menu-item" onclick="saveSystem.saveGame()">
        <svg viewBox="0 0 24 24">
            <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm2 16H5V5h11.17L19 7.83V19zm-7-7c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
        </svg>
        &#x4fdd;&#x5b58;&#x6e38;&#x620f;
    </div>
    <div class="menu-item" onclick="saveSystem.loadGame()">
        <svg viewBox="0 0 24 24">
            <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm4 18H6V4h7v5h5v11z"/>
        </svg>
        &#x8bfb;&#x53d6;&#x6e38;&#x620f;
    </div>
    <div class="menu-item" id="achievementsMenuItem">
        <svg viewBox="0 0 24 24">
            <path d="M19 5h-2V3H7v2H5c-1.1 0-2 .9-2 2v1c0 2.55 1.92 4.63 4.39 4.94.63 1.5 1.98 2.63 3.61 2.96V19H7v2h10v-2h-4v-3.1c1.63-.33 2.98-1.46 3.61-2.96C19.08 12.63 21 10.55 21 8V7c0-1.1-.9-2-2-2zm-2 3H7V7h10v1z"/>
        </svg>
        &#x6210;&#x5c31;&#x5217;&#x8868;
        <div class="achievements-submenu" style="display: none;">
            <div class="achievements-list" id="achievementsList"></div>
        </div>
    </div>
    <div class="menu-item" onclick="returnToHome()">
        <svg viewBox="0 0 24 24">
            <path d="M10 20v-6h4l5 5V4L14 10H10zM4 10l6 6v-6H4z"/>
        </svg>
        &#x8fd4;&#x56de;&#x4e3b;&#x9875;
    </div>
</div>

<div class="story-progress">
    <div class="story-progress-bar">
        <div class="story-progress-fill" id="storyProgressFill"></div>
    </div>
</div>

<div class="progress-container">
    <div class="progress-bar">
        <div class="progress" id="progressBar"></div>
    </div>
    <div class="current-level" id="currentLevel">&#x7b2c; 1 &#x5173; / 15 &#x5173;</div>
</div>

<div class="inventory">
    <h3>&#x6536;&#x96c4;&#x7269;&#x54c1;</h3>
    <div class="inventory-items" id="inventoryItems"></div>
</div>

<div class="game-header">
    <h1 class="game-title">&#x667a;&#x6167;&#x517b;&#x751f;&#x4e4b;&#x95e8;&#xff1a;&#x4e2d;&#x533b;&#x667a;&#x80fd;&#x5316;&#x63a2;&#x9669;</h1>
    <div class="stats-container">
        <div class="stat-card">
            <div class="stat-value" id="questsCompleted">0</div>
            <div class="stat-label">&#x5df2;&#x5b8c;&#x6210;&#x5173;&#x5361;</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="itemsCollected">0</div>
            <div class="stat-label">&#x6536;&#x96c4;&#x7269;&#x54c1;</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="score">0</div>
            <div class="stat-label">&#x603b;&#x5206;</div>
        </div>
    </div>
</div>

<div class="game-container" id="gameContainer" style="display: none;">
    <!-- Content will be dynamically inserted here -->
    <div class="game-over" id="gameOver">
        <h2>&#x606d;&#x559c;&#x4f60;&#x5b8c;&#x6210;&#x4e86;&#x6240;&#x6709;&#x5173;&#x5361;&#xff01;</h2>
        <p>&#x4f60;&#x5df2;&#x7ecd;&#x51fa;&#x73a0;&#x8fd9;&#x4e2a;&#x9752;&#x5e38;&#x7684;&#x65c5;&#x52a0;&#x5417;&#xff1f;</p>
    </div>
</div>

<div class="start-screen" id="startScreen">
    <div class="start-content">
        <h1>&#x667a;&#x6167;&#x517b;&#x751f;&#x4e4b;&#x95e8;&#xff1a;&#x4e2d;&#x533b;&#x667a;&#x80fd;&#x5316;&#x63a2;&#x9669;</h1>
        <div class="start-description">
            <p>&#x6b22;&#x8fce;&#x6765;&#x5230;&#x8fd9;&#x4e2a;&#x6c47;&#x7ed9;&#x4e2d;&#x533b;&#x548c;&#x6700;&#x65b0;&#x6280;&#x672f;&#x7684;&#x9752;&#x5e38;&#x4e16;&#x754c;&#xff01;</p>
            <p>&#x5728;&#x6b64;&#xff0c;&#x4f60;&#x5c06;&#x641c;&#x72d0;&#xff1a;</p>
            <ul>
                <li>&#x53e4;&#x4e2d;&#x533b;&#x7684;&#x670d;&#x53cb;&#x4e16;&#x754c;</li>
                <li>&#x6700;&#x65b0;&#x6280;&#x672f;&#x7684;&#x521b;&#x4e1a;</li>
                <li>&#x667a;&#x80fd;&#x5316;&#x548c;&#x5e26;&#x751f;&#x5f53;&#x7684;&#x4e3b;&#x8981;</li>
                <li>&#x4e00;&#x4e9b;&#x7c89;&#x4e2d;&#x7684;&#x751f;&#x7269;&#x7684;&#x4f5c;&#x7528;</li>
            </ul>
            <p>&#x5df2;&#x7ecd;&#x51fa;&#x73a0;&#x8fd9;&#x4e2a;&#x9752;&#x5e38;&#x7684;&#x65c5;&#x52a0;&#x5417;&#xff1f;</p>
        </div>
        <button id="startButton" class="start-btn">&#x5f00;&#x59cb;&#x63a2;&#x9669;</button>
    </div>
</div>

<div class="audio-controls">
    <button id="toggleSound" class="sound-btn">
        <svg viewBox="0 0 24 24" width="24" height="24">
            <path fill="#00ff87" d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
        </svg>
    </button>
</div>

<div class="character-portrait">
    <img class="character-image" src alt="Character Portrait">
</div>

<div class="background-transition"></div>

<div class="particle-container"></div>

<script>const gameData = {
  currentLevel: 0,
  inventory: [],
  totalLevels: 15,
  score: 0,
  achievements: [],
  storyProgress: 0,
  textSpeed: 50
};
const gameFeatures = {
  particles: true,
  soundEffects: true,
  backgroundMusic: true,
  characterVoices: false,
  textSpeed: 50
};
const questions = [{
  story: "你进入一座古老的书房，看到一本名为《中医的未来》的书。书中提到传统中医与现代科技的结合之道。在书旁，一道传送门等待着你的选择。",
  question: "你如何看待中医的现代化与智能化发展？",
  options: [{
    text: "非常支持，我认为中医需要借助现代科技来创新",
    reward: "现代智慧草药"
  }, {
    text: "愿意尝试，但并不确定中医的未来发展",
    reward: "探索草药"
  }, {
    text: "不支持，我认为中医应该保持传统",
    reward: "传统秘方"
  }]
}, {
  story: "你走进一座宽敞的大厅，看到两位学者激烈讨论，一个是中医大师，另一个是西医专家。他们请你加入讨论，解答他们之间的争论。",
  question: "你是否认为中医和西医可以互补，帮助治疗疾病？",
  options: [{
    text: "是的，二者可以互相补充",
    reward: "和谐之道"
  }, {
    text: "不确定，二者有时会冲突",
    reward: "怀疑之门"
  }, {
    text: "不认为，西医才是唯一有效的治疗方法",
    reward: "单一治疗法"
  }]
}, {
  story: "你进入了一座充满智能设备的实验室，可以实时监测身体健康。你面前的设备可以通过数据帮助你了解身体状况。",
  question: "你是否愿意使用智能设备来跟踪你的健康数据？",
  options: [{
    text: "非常愿意，我认为它有助于更好地管理健康",
    reward: "健康之眼"
  }, {
    text: "愿意，但需要更多了解",
    reward: "数据探索者"
  }, {
    text: "不愿意，我更倾向于传统健康管理方式",
    reward: "传统之道"
  }]
}, {
  story: "你来到一座展览馆，展示了各种中医养生产品。这些产品基于多种传统理论。",
  question: "你是否了解过或正在使用基于传统中医理论的养生产品吗？",
  options: [{
    text: "是的，已经在使用并看到一定效果",
    reward: "调和药剂"
  }, {
    text: "有了解过，但还没有使用",
    reward: "学习之路"
  }, {
    text: "不太了解，也没有兴趣使用",
    reward: "传统智慧"
  }]
}, {
  story: "你进入了一间数据中心，看到告示板上写着：开放数据助力中医智能化研究。",
  question: "你是否支持通过开放数据和共享的方式来促进中医智能化研究？",
  options: [{
    text: "完全支持，我认为这对社会和科研有益",
    reward: "数据共享"
  }, {
    text: "中立，取决于如何使用我的数据",
    reward: "谨慎之道"
  }, {
    text: "不支持，我不愿意分享个人健康数据",
    reward: "保守者"
  }]
}, {
  story: "你来到了一个现代化的健康追踪室，房间里摆满了各种设备和工具。",
  question: "你是否愿意通过定期追踪和管理健康指标来实现个性化的养生建议和目标？",
  options: [{
    text: "完全愿意，我认为定期追踪有助于持续改进健康",
    reward: "健康之道"
  }, {
    text: "愿意，但不确定是否能坚持",
    reward: "探索之钥"
  }, {
    text: "不愿意，我认为偶尔了解健康状况即可",
    reward: "自由之符"
  }]
}, {
  story: "你来到一座展览会，展出许多智能手环、手表等可穿戴设备。",
  question: "你对可穿戴设备在健康管理中的作用有何看法？",
  options: [{
    text: "我认为它们非常有效，可以帮助我实时了解健康状况",
    reward: "实时健康"
  }, {
    text: "我觉得它们有一定作用，但不确定是否足够重要",
    reward: "智能探索者"
  }, {
    text: "不认为，他们有用，习惯通过传统方式管理健康",
    reward: "传统护符"
  }]
}, {
  story: "你在一个现代化的数据分析中心看到许多治疗工具和建议。",
  question: "你是否支持利用大数据和人工智能来优化中医的诊断和治疗方案？",
  options: [{
    text: "完全支持，我认为大数据可以帮助改善中医治疗效果",
    reward: "大数据分析"
  }, {
    text: "支持，但需要小心使用",
    reward: "传统与现代融合"
  }, {
    text: "不支持，我认为中医应坚持传统诊疗方法",
    reward: "传统之道"
  }]
}, {
  story: "你走进一个充满草药和传统中医药方的馆内。",
  question: "你是否倾向于选择自然草药疗法来处理日常健康问题？",
  options: [{
    text: "完全倾向，草药疗法自然、安全",
    reward: "草药之道"
  }, {
    text: "不确定，偶尔使用草药治疗",
    reward: "草药探索者"
  }, {
    text: "不倾向，我更喜欢现代医学治疗方法",
    reward: "现代医学"
  }]
}, {
  story: "你进入了一间数据中心，看到一个大屏幕显示着中医健康数据的分析。",
  question: "你是否愿意接受根据个人健康数据量身定制的中医治疗方案？",
  options: [{
    text: "愿意，认为这可以提高治疗的有效性",
    reward: "个性化治疗"
  }, {
    text: "愿意尝试，但仍然对其效果保持怀疑",
    reward: "尝试之道"
  }, {
    text: "不愿意，我更喜欢常规治疗方法",
    reward: "传统疗法"
  }]
}, {
  story: "你走进一个现代化的健康管理实验室。",
  question: "你是否愿意接受技术支持来管理和优化自己的健康状况？",
  options: [{
    text: "完全愿意，科技的辅助能提高我的健康水平",
    reward: "科技健康"
  }, {
    text: "有些犹豫，我觉得过度依赖技术可能会失去自主性",
    reward: "健康之道"
  }, {
    text: "不愿意，我更倾向于自然的健康管理方式",
    reward: "传统智慧"
  }]
}, {
  story: "你来到一座情绪调节大厅，看到各种中医情绪治疗的方法。",
  question: "你是否认为中医能有效改善情绪健康？",
  options: [{
    text: "完全认为，中医有助于调节情绪和压力",
    reward: "情绪治疗"
  }, {
    text: "有一定效果，但更依赖于个人情况",
    reward: "情绪调节之道"
  }, {
    text: "不认为，中医无法有效调节情绪",
    reward: "现代情绪管理"
  }]
}, {
  story: "你在一个现代化的自我疗法站点看到许多治疗工具和建议。",
  question: "你是否倾向于自我治疗来提高身体健康？",
  options: [{
    text: "是的，自我治疗有助于我的身心健康",
    reward: "自我疗法"
  }, {
    text: "有些尝试过，但效果不一",
    reward: "探索之道"
  }, {
    text: "不倾向，我更喜欢寻求专业医疗帮助",
    reward: "专业医疗"
  }]
}, {
  story: "你来到了游戏的最终区域，面对着未来健康的蓝图。",
  question: "你如何看待未来健康管理与科技结合的前景？",
  options: [{
    text: "极为期待，科技将彻底改变我们的健康管理方式",
    reward: "未来健康"
  }, {
    text: "中立，期待科技进步，但也有些担忧",
    reward: "平衡之道"
  }, {
    text: "不太期待，我更相信传统的健康管理方式",
    reward: "传统信念"
  }]
}, {
  story: "你来到了游戏的终点，面对着一个古老的智慧宝盒。",
  question: "你认为未来科技与传统中医能否成功融合，创造出更好的健康管理方法？",
  options: [{
    text: "认为可以，未来科技和中医会找到完美的结合点",
    reward: "智慧融合"
  }, {
    text: "认为有一定挑战，但也有可能融合成功",
    reward: "融合探索者"
  }, {
    text: "不认为，科技和中医无法完全融合",
    reward: "传统之道"
  }]
}];
const achievementList = [];
const achievementSystem = {
  achievements: [],
  unlock(id, title, description) {
    if (!this.achievements.includes(id)) {
      this.achievements.push(id);
      showAchievement(title);
      this.updateAchievementList();
    }
  },
  updateAchievementList() {
    const list = document.getElementById('achievementsList');
    if (list) {
      list.innerHTML = this.achievements.map(id => `<div class="achievement-item">${id}</div>`).join('');
    }
  }
};
class ParticleSystem {
  constructor() {
    this.particles = [];
    this.container = document.createElement('div');
    this.container.className = 'particle-container';
    document.body.appendChild(this.container);
  }
  createParticle(x, y) {
    const particle = document.createElement('div');
    particle.style.cssText = `
      position: absolute;
      width: 4px;
      height: 4px;
      background: #00ff87;
      border-radius: 50%;
      left: ${x}px;
      top: ${y}px;
      pointer-events: none;
    `;
    this.container.appendChild(particle);
    const angle = Math.random() * Math.PI * 2;
    const velocity = Math.random() * 2 + 1;
    const lifetime = Math.random() * 1000 + 500;
    return {
      element: particle,
      angle,
      velocity,
      lifetime,
      birth: Date.now()
    };
  }
  emit(x, y, count = 10, type = 'default') {
    const colors = {
      default: '#00ff87',
      achievement: '#ffd700',
      transition: '#ffffff'
    };
    for (let i = 0; i < count; i++) {
      const particle = document.createElement('div');
      particle.style.cssText = `
        position: absolute;
        width: ${type === 'transition' ? '6px' : '4px'};
        height: ${type === 'transition' ? '6px' : '4px'};
        background: ${colors[type]};
        border-radius: 50%;
        left: ${x}px;
        top: ${y}px;
        pointer-events: none;
        filter: blur(1px);
        box-shadow: 0 0 5px ${colors[type]};
      `;
      this.container.appendChild(particle);
      const angle = Math.random() * Math.PI * 2;
      const velocity = Math.random() * 2 + (type === 'transition' ? 2 : 1);
      const lifetime = Math.random() * 1000 + (type === 'transition' ? 1000 : 500);
      this.particles.push({
        element: particle,
        angle,
        velocity,
        lifetime,
        birth: Date.now()
      });
    }
  }
  update() {
    const now = Date.now();
    this.particles = this.particles.filter(particle => {
      const age = now - particle.birth;
      if (age > particle.lifetime) {
        particle.element.remove();
        return false;
      }
      const x = parseFloat(particle.element.style.left);
      const y = parseFloat(particle.element.style.top);
      particle.element.style.left = `${x + Math.cos(particle.angle) * particle.velocity}px`;
      particle.element.style.top = `${y + Math.sin(particle.angle) * particle.velocity}px`;
      particle.element.style.opacity = 1 - age / particle.lifetime;
      return true;
    });
  }
}
function getItemDescription(item) {
  const descriptions = {
    "现代智慧草药": "融合现代科技与传统中医的智慧结晶，蕴含强大的治愈能力。",
    "探索草药": "一株神秘的草药，散发着淡淡的光芒，似乎在等待被发现。",
    "传统秘方": "古老的医书中记载的神秘配方，传承了数千年的智慧。",
    "和谐之道": "象征着中西医和谐共存的至理，闪耀着金色的光芒。",
    "怀疑之门": "一扇半开的门，通向未知的领域，考验着探索者的智慧。",
    "单一治疗法": "代表着专注与执着的治疗之道，散发着纯粹的能量。"
  };
  return descriptions[item] || "一件神秘的物品，等待着被了解和使用。";
}
function showItemDescription(description, element) {
  const existingTooltip = document.querySelector('.item-tooltip');
  if (existingTooltip) {
    existingTooltip.remove();
  }
  const tooltip = document.createElement('div');
  tooltip.className = 'item-tooltip';
  tooltip.style.cssText = `
        position: absolute;
        background: rgba(0, 0, 0, 0.9);
        border: 1px solid rgba(0, 255, 135, 0.5);
        padding: 1rem;
        border-radius: 8px;
        font-size: 0.9rem;
        max-width: 250px;
        z-index: 1001;
        pointer-events: none;
        animation: tooltipFadeIn 0.3s ease;
    `;
  tooltip.textContent = description;
  const rect = element.getBoundingClientRect();
  tooltip.style.left = `${rect.right + 10}px`;
  tooltip.style.top = `${rect.top}px`;
  document.body.appendChild(tooltip);
  const style = document.createElement('style');
  style.textContent = `
        @keyframes tooltipFadeIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }
    `;
  document.head.appendChild(style);
  element.addEventListener('mouseleave', () => {
    tooltip.remove();
  });
}
function animateText(text, element) {
  const speed = 30;
  let i = 0;
  element.textContent = '';
  return new Promise(resolve => {
    function addChar() {
      if (i < text.length) {
        element.textContent += text.charAt(i);
        if (text.charAt(i) !== ' ' && text.charAt(i) !== '\n') {
          const audio = new Audio('data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA==');
          audio.volume = 0.1;
          audio.play().catch(() => {});
        }
        i++;
        setTimeout(addChar, speed);
      } else {
        resolve();
      }
    }
    addChar();
  });
}
function createOptionButton(option, container) {
  const button = document.createElement('button');
  button.className = 'option-btn';
  button.textContent = option.text;
  button.addEventListener('click', () => {
    const optionsContainer = container.querySelector('.options');
    optionsContainer.querySelectorAll('button').forEach(btn => {
      btn.disabled = true;
      btn.style.opacity = '0.5';
    });
    const resultElement = document.createElement('div');
    resultElement.className = 'result';
    resultElement.textContent = `获得：${option.reward}`;
    container.appendChild(resultElement);
    resultElement.style.display = 'block';
    gameData.inventory.push(option.reward);
    const toast = document.createElement('div');
    toast.className = 'achievement-toast';
    toast.innerHTML = `
      <h3>获得物品！</h3>
      <p>${option.reward}</p>
    `;
    document.body.appendChild(toast);
    setTimeout(() => {
      toast.classList.add('toast-fade-out');
      setTimeout(() => {
        toast.remove();
      }, 500);
    }, 5000);
    if (gameData.inventory.length === 5) {
      showAchievement('收集者：获得5件物品！');
    } else if (gameData.inventory.length === 10) {
      showAchievement('探索大师：获得10件物品！');
    }
    const choiceValue = {
      "非常支持，我认为中医需要借助现代科技来创新": 100,
      "愿意尝试，但并不确定中医的未来发展": 50,
      "不支持，我认为中医应该保持传统": 0,
      "是的，二者可以互相补充": 100,
      "不确定，二者有时会冲突": 50,
      "不认为，西医才是唯一有效的治疗方法": 0,
      "完全认为，中医有助于调节情绪和压力": 100,
      "有一定效果，但更依赖于个人情况": 50,
      "不认为，中医无法有效调节情绪": 0,
      "认为可以，未来科技和中医会找到完美的结合点": 100,
      "认为有一定挑战，但也有可能融合成功": 50,
      "不认为，科技和中医无法完全融合": 0
    }[option.text] || 50;
    gameData.score += choiceValue;
    updateProgress();
    updateStats();
    container.classList.add('scene-exit-active');
    setTimeout(() => {
      container.remove();
      gameData.currentLevel++;
      if (gameData.currentLevel < questions.length) {
        const newContainer = createLevel(questions[gameData.currentLevel]);
        document.getElementById('gameContainer').appendChild(newContainer);
      } else {
        showGameOver();
      }
    }, 800);
  });
  return button;
}
function createLevel(levelData) {
  const container = document.createElement('div');
  container.className = 'story-section scene-enter';
  const transition = document.createElement('div');
  transition.className = 'background-transition';
  container.appendChild(transition);
  if (levelData.character) {
    const portrait = document.createElement('div');
    portrait.className = 'character-portrait';
    portrait.innerHTML = `<div class="character-image"></div>`;
    container.appendChild(portrait);
  }
  const pattern = document.createElement('div');
  pattern.className = 'scene-pattern';
  container.appendChild(pattern);
  const storyText = document.createElement('div');
  storyText.className = 'story-text';
  container.appendChild(storyText);
  function typewriterEffect(text, element) {
    const speed = 40;
    let i = 0;
    element.textContent = '';
    return new Promise(resolve => {
      function addChar() {
        if (i < text.length) {
          element.textContent += text.charAt(i);
          const nextChar = text.charAt(i);
          let delay = speed;
          if (['.', '!', '?', '。', '！', '？'].includes(nextChar)) {
            delay = speed * 8;
          } else if (['.', ','].includes(nextChar)) {
            delay = speed * 4;
          }
          i++;
          setTimeout(addChar, delay);
        } else {
          resolve();
        }
      }
      addChar();
    });
  }
  typewriterEffect(levelData.story, storyText).then(() => {
    const questionElement = document.createElement('div');
    questionElement.className = 'question';
    questionElement.style.cssText = `
            font-size: 1.5rem;
            margin: 2rem 0;
            color: #00ff87;
            text-shadow: 0 0 10px rgba(0,255,135,0.5);
            padding: 1rem;
            background: rgba(0,0,0,0.6);
            border-radius: 10px;
        `;
    return typewriterEffect(levelData.question, questionElement).then(() => {
      container.appendChild(questionElement);
      const optionsContainer = document.createElement('div');
      optionsContainer.className = 'options';
      optionsContainer.style.marginTop = '2rem';
      levelData.options.forEach((option, index) => {
        setTimeout(() => {
          const button = createOptionButton(option, container);
          optionsContainer.appendChild(button);
          button.style.opacity = '0';
          button.style.transform = 'translateX(-20px)';
          requestAnimationFrame(() => {
            button.style.opacity = '1';
            button.style.transform = 'translateX(0)';
          });
        }, index * 300);
      });
      container.appendChild(optionsContainer);
    });
  });
  requestAnimationFrame(() => {
    container.classList.remove('scene-enter');
  });
  return container;
}
function transitionToNextScene(currentContainer, nextLevelData) {
  const overlay = document.createElement('div');
  overlay.className = 'scene-transition-overlay';
  document.body.appendChild(overlay);
  const particleSystem = new ParticleSystem();
  for (let i = 0; i < 20; i++) {
    const x = Math.random() * window.innerWidth;
    const y = Math.random() * window.innerHeight;
    particleSystem.emit(x, y, 5, 'transition');
  }
  requestAnimationFrame(() => {
    overlay.classList.add('scene-transition-active');
    setTimeout(() => {
      currentContainer.remove();
      const newContainer = createLevel(nextLevelData);
      document.getElementById('gameContainer').appendChild(newContainer);
      const progress = gameData.currentLevel / gameData.totalLevels * 100;
      document.getElementById('storyProgressFill').style.width = `${progress}%`;
      setTimeout(() => {
        overlay.classList.remove('scene-transition-active');
        setTimeout(() => overlay.remove(), 500);
      }, 500);
    }, 500);
  });
}
function updateProgress() {
  const progress = gameData.currentLevel / gameData.totalLevels * 100;
  document.getElementById('progressBar').style.width = `${progress}%`;
  document.getElementById('currentLevel').textContent = `第 ${gameData.currentLevel + 1} 关 / ${gameData.totalLevels} 关`;
}
function showAchievement(text) {
  if (!achievementList.includes(text)) {
    achievementList.push(text);
    updateAchievementsList();
  }
  const toast = document.createElement('div');
  toast.className = 'achievement-toast';
  toast.innerHTML = `
    <h3>成就解锁！</h3>
    <p>${text}</p>
    <small>${new Date().toLocaleString()}</small>
  `;
  document.body.appendChild(toast);
  setTimeout(() => {
    toast.classList.add('toast-fade-out');
    setTimeout(() => {
      toast.remove();
    }, 500);
  }, 5000);
  const particleSystem = new ParticleSystem();
  for (let i = 0; i < 10; i++) {
    const x = Math.random() * window.innerWidth;
    const y = Math.random() * window.innerHeight;
    particleSystem.emit(x, y, 5, 'achievement');
  }
}
function updateAchievementsList() {
  const achievementsList = document.querySelector('.achievements-list');
  if (achievementsList) {
    let content = '';
    if (gameData.inventory.length > 0) {
      content += `
        <div class="achievement-category">
          <h3>收集物品 (${gameData.inventory.length}个)</h3>
          <div class="achievement-category-description">
            探索游戏过程中获得的珍贵物品，每个物品都蕴含着独特的价值和意义。
          </div>
      `;
      gameData.inventory.forEach(item => {
        content += `
          <div class="achievement-list-item inventory-item">
            <div class="item-header">
              <span class="achievement-icon">🎁</span>
              <span class="achievement-title">${item}</span>
            </div>
            <div class="item-details">
              <p class="item-description">${getItemDescription(item)}</p>
              <span class="item-rarity">珍稀度: ${getItemRarity(item)}</span>
              <span class="item-acquisition">获得时间: ${new Date().toLocaleString()}</span>
            </div>
          </div>
        `;
      });
      content += '</div>';
    }
    if (achievementList.length > 0) {
      content += `
        <div class="achievement-category">
          <h3>游戏成就 (${achievementList.length}个)</h3>
          <div class="achievement-category-description">
            在游戏过程中解锁的特殊成就，记录着你的探索历程和重要时刻。
          </div>
      `;
      achievementList.forEach(achievement => {
        content += `
          <div class="achievement-list-item">
            <div class="achievement-header">
              <span class="achievement-icon">🏆</span>
              <span class="achievement-title">${achievement}</span>
            </div>
            <div class="achievement-details">
              <p class="achievement-description">${getAchievementDescription(achievement)}</p>
              <span class="achievement-date">解锁时间: ${new Date().toLocaleString()}</span>
            </div>
          </div>
        `;
      });
      content += '</div>';
    }
    if (!content) {
      content = `
        <div class="achievement-list-empty">
          <div class="empty-icon">🔍</div>
          <h3>暂无成就</h3>
          <p>继续探索游戏来获得更多成就和物品！每个选择都可能带来意想不到的收获。</p>
        </div>
      `;
    }
    achievementsList.innerHTML = content;
  }
}
function getItemRarity(item) {
  const rarityMap = {
    "现代智慧草药": "传说级",
    "探索草药": "稀有",
    "传统秘方": "史诗级",
    "和谐之道": "传说级",
    "怀疑之门": "稀有",
    "单一治疗法": "普通"
  };
  return rarityMap[item] || "普通";
}
function getAchievementDescription(achievement) {
  const descriptionMap = {
    "收集者：获得5件物品！": "初步探索世界，收集了5件独特物品，展现出探索者的潜力。",
    "探索大师：获得10件物品！": "深入探索世界，收集了10件珍贵物品，证明了你的探索实力。",
    "游戏通关！恭喜完成所有关卡！": "完成了所有挑战，见证了完整的故事，你是真正的勇者！"
  };
  return descriptionMap[achievement] || "一个神秘的成就，继续探索来了解更多！";
}
const audioContext = new (window.AudioContext || window.webkitAudioContext)();
const soundEffects = {
  click: createClickSound(),
  achievement: createAchievementSound(),
  transition: createTransitionSound()
};
function createClickSound() {
  const oscillator = audioContext.createOscillator();
  const gainNode = audioContext.createGain();
  oscillator.connect(gainNode);
  gainNode.connect(audioContext.destination);
  oscillator.type = 'sine';
  oscillator.frequency.value = 800;
  gainNode.gain.value = 0.1;
  return {
    play: () => {
      oscillator.start();
      setTimeout(() => oscillator.stop(), 50);
    }
  };
}
function createAchievementSound() {
  const oscillator = audioContext.createOscillator();
  const gainNode = audioContext.createGain();
  oscillator.connect(gainNode);
  gainNode.connect(audioContext.destination);
  oscillator.type = 'sine';
  oscillator.frequency.value = 1200;
  gainNode.gain.value = 0.1;
  return {
    play: () => {
      oscillator.start();
      setTimeout(() => oscillator.stop(), 50);
    }
  };
}
function createTransitionSound() {
  const oscillator = audioContext.createOscillator();
  const gainNode = audioContext.createGain();
  oscillator.connect(gainNode);
  gainNode.connect(audioContext.destination);
  oscillator.type = 'sine';
  oscillator.frequency.value = 1000;
  gainNode.gain.value = 0.1;
  return {
    play: () => {
      oscillator.start();
      setTimeout(() => oscillator.stop(), 50);
    }
  };
}
const saveSystem = {
  saveGame: () => {
    const saveData = {
      currentLevel: gameData.currentLevel,
      inventory: gameData.inventory,
      score: gameData.score,
      achievements: achievementList
    };
    localStorage.setItem('visualNovelSave', JSON.stringify(saveData));
    showNotification('游戏已保存');
    const particleSystem = new ParticleSystem();
    for (let i = 0; i < 10; i++) {
      const x = Math.random() * window.innerWidth;
      const y = Math.random() * window.innerHeight;
      particleSystem.emit(x, y, 5, 'achievement');
    }
  },
  loadGame: () => {
    const saveData = localStorage.getItem('visualNovelSave');
    if (saveData) {
      const data = JSON.parse(saveData);
      gameData.currentLevel = data.currentLevel;
      gameData.inventory = data.inventory;
      gameData.score = data.score;
      achievementList.length = 0;
      achievementList.push(...data.achievements);
      updateAchievementsList();
      showLevel(gameData.currentLevel);
      updateStats();
      showNotification('游戏已读取');
    }
  }
};
function showNotification(message) {
  const notification = document.createElement('div');
  notification.className = 'notification';
  notification.textContent = message;
  document.body.appendChild(notification);
  setTimeout(() => {
    notification.classList.add('fade-out');
    setTimeout(() => notification.remove(), 500);
  }, 2000);
}
const menuToggle = document.getElementById('menuToggle');
const gameMenu = document.getElementById('gameMenu');
menuToggle.addEventListener('click', () => {
  gameMenu.classList.toggle('active');
});
document.addEventListener('click', e => {
  if (!gameMenu.contains(e.target) && !menuToggle.contains(e.target)) {
    gameMenu.classList.remove('active');
  }
});
function returnToHome() {
  const startScreen = document.getElementById('startScreen');
  const gameContainer = document.getElementById('gameContainer');
  gameContainer.style.display = 'none';
  startScreen.style.display = 'flex';
  startScreen.style.opacity = '1';
  gameData.currentLevel = 0;
  gameData.score = 0;
  gameData.inventory = [];
  updateStats();
  document.getElementById('inventoryItems').innerHTML = '';
  gameMenu.classList.remove('active');
  showNotification('已返回主页');
}
window.addEventListener('load', () => {
  const startScreen = document.getElementById('startScreen');
  const startButton = document.getElementById('startButton');
  const gameContainer = document.getElementById('gameContainer');
  gameContainer.style.display = 'none';
  const description = document.querySelector('.start-description');
  const listItems = description.querySelectorAll('li');
  listItems.forEach((item, index) => {
    item.style.opacity = '0';
    item.style.transform = 'translateX(-20px)';
    setTimeout(() => {
      item.style.opacity = '1';
      item.style.transform = 'translateX(0)';
      item.style.transition = 'all 0.5s ease';
    }, index * 200);
  });
  startButton.addEventListener('click', () => {
    startScreen.style.opacity = '0';
    startScreen.style.transition = 'opacity 0.5s ease';
    const loadingScreen = document.createElement('div');
    loadingScreen.className = 'loading-screen';
    loadingScreen.innerHTML = `
        <h2 style="color: #fff; margin-bottom: 20px;">加载游戏资源中...</h2>
        <div class="loading-bar">
            <div class="loading-progress"></div>
        </div>
        <div class="loading-text">正在初始化游戏...</div>
    `;
    document.body.appendChild(loadingScreen);
    const progressBar = loadingScreen.querySelector('.loading-progress');
    const loadingText = loadingScreen.querySelector('.loading-text');
    let progress = 0;
    const loadingInterval = setInterval(() => {
      progress += Math.random() * 15;
      if (progress > 100) progress = 100;
      progressBar.style.width = `${progress}%`;
      if (progress < 30) {
        loadingText.textContent = "正在加载游戏资源...";
      } else if (progress < 60) {
        loadingText.textContent = "准备游戏场景...";
      } else if (progress < 90) {
        loadingText.textContent = "即将进入游戏...";
      } else {
        loadingText.textContent = "载入完成！";
      }
      if (progress === 100) {
        clearInterval(loadingInterval);
        setTimeout(() => {
          loadingScreen.style.opacity = '0';
          loadingScreen.style.transition = 'opacity 0.5s ease';
          setTimeout(() => {
            loadingScreen.remove();
            startScreen.style.display = 'none';
            gameContainer.style.display = 'block';
            gameData.currentLevel = 0;
            gameData.score = 0;
            gameData.inventory = [];
            achievementList.length = 0;
            showLevel(0);
            updateStats();
            const particleSystem = new ParticleSystem();
            for (let i = 0; i < 20; i++) {
              const x = Math.random() * window.innerWidth;
              const y = Math.random() * window.innerHeight;
              particleSystem.emit(x, y, 5, 'transition');
            }
          }, 500);
        }, 1000);
      }
    }, 100);
  });
  achievementSystem.updateAchievementList();
});
document.addEventListener('DOMContentLoaded', () => {
  const gameControls = document.querySelector('.game-controls');
  if (gameControls) {
    gameControls.remove();
  }
});
function showLevel(levelIndex) {
  const transition = document.querySelector('.background-transition');
  transition.classList.add('active');
  setTimeout(() => {
    const gameContainer = document.getElementById('gameContainer');
    const currentSection = gameContainer.querySelector('.story-section');
    if (currentSection) {
      currentSection.remove();
    }
    if (levelIndex < questions.length) {
      const newSection = createLevel(questions[levelIndex]);
      gameContainer.appendChild(newSection);
      if (gameFeatures.particles) {
        const particleSystem = new ParticleSystem();
        for (let i = 0; i < 5; i++) {
          const x = Math.random() * window.innerWidth;
          const y = Math.random() * window.innerHeight;
          particleSystem.emit(x, y);
        }
        function updateParticles() {
          particleSystem.update();
          if (particleSystem.particles.length > 0) {
            requestAnimationFrame(updateParticles);
          }
        }
        updateParticles();
      }
    } else {
      showGameOver();
    }
    setTimeout(() => {
      transition.classList.remove('active');
    }, 500);
  }, 500);
}
function showGameOver() {
  const gameOver = document.getElementById('gameOver');
  const analysis = analyzeChoices();
  gameOver.innerHTML = `
    <h2>游戏结束！</h2>
    <div class="analysis-container">
      <h3 class="analysis-title">你的中医态度分析</h3>
      <div class="analysis-score">
        得分: ${analysis.actualScore} / ${analysis.totalPossibleScore}
      </div>
      <div class="analysis-text">
        <p><strong>你的身份是:</strong> ${analysis.identity}</p>
        <p><strong>中医认可度:</strong> ${analysis.tcmPreferenceScore}%</p>
        <p><strong>详细分析:</strong> ${analysis.analysis}</p>
      </div>
      <div class="roast-text">
        ${analysis.roast}
      </div>
      <div class="qr-code-section">
        <h3>加入我们的中医智能化探索社区！</h3>
        <p>扫描下方二维码，与其他探索者交流分享你的见解。</p>
        <div class="qr-code-container">
          <svg class="qr-code" viewBox="0 0 41 41">
            <path d="M1 1h7v7h-7zM33 1h7v7h-7zM1 33h7v7h-7z" fill="#00ff87"/>
            <path d="M10 1h3v1h-3zM16 1h4v1h-4zM24 1h3v1h-3zM10 7h3v1h-3zM16 7h4v1h-4zM24 7h3v1h-3zM1 10h1v3h-1zM7 10h1v3h-1zM33 10h1v3h-1zM39 10h1v3h-1zM1 16h1v4h-1zM7 16h1v4h-1zM33 16h1v4h-1zM39 16h1v4h-1zM1 24h1v3h-1zM7 24h1v3h-1zM33 24h1v3h-1zM39 24h1v3h-1zM10 33h3v1h-3zM16 33h4v1h-4zM24 33h3v1h-3zM10 39h3v1h-3zM16 39h4v1h-4zM24 39h3v1h-3z" fill="#00ff87"/>
          </svg>
        </div>
        <p>加入我们，开启更多关于中医智能化的精彩对话！</p>
      </div>
    </div>
  `;
  gameOver.style.display = 'block';
  showAchievement('游戏通关！恭喜完成所有关卡！');
  const particleSystem = new ParticleSystem();
  for (let i = 0; i < 20; i++) {
    const x = Math.random() * window.innerWidth;
    const y = Math.random() * window.innerHeight;
    particleSystem.emit(x, y, 10, 'achievement');
  }
}
function updateStats() {
  document.getElementById('questsCompleted').textContent = gameData.currentLevel;
  document.getElementById('itemsCollected').textContent = gameData.inventory.length;
  document.getElementById('score').textContent = gameData.score;
}
function analyzeChoices() {
  let traditionalScore = 0;
  let modernScore = 0;
  const totalPossibleScore = gameData.currentLevel * 100;
  const actualScore = gameData.score;
  const tcmPreferenceScore = actualScore / totalPossibleScore * 100;
  let identity = '';
  let roast = '';
  let analysis = '';
  if (tcmPreferenceScore >= 75) {
    identity = '坚定的中医传统派';
    roast = '你对中医的认可度非常高，看来是个真正的中医粉丝！';
    analysis = '从你的选择来看，你非常支持中医的发展和创新，同时也认可传统价值。';
  } else if (tcmPreferenceScore >= 50) {
    identity = '温和的中医支持者';
    roast = '既不排斥传统也不拒绝创新，相当理性的态度！';
    analysis = '你对中医持开放态度，能接受传统与现代的结合。这种平衡的观点值得肯定。';
  } else if (tcmPreferenceScore >= 25) {
    identity = '科技派中医观察者';
    roast = '看来你对中医持谨慎态度，更相信科技的力量？';
    analysis = '你倾向于用现代眼光看待中医，这种审慎的态度也有其合理性。';
  } else {
    identity = '中医怀疑派';
    roast = '看来你是个彻底的科技派！不过中医的智慧也许值得一探？';
    analysis = '从你的选择来看，你对中医持较为怀疑的态度，更信赖现代医学。';
  }
  return {
    actualScore,
    totalPossibleScore,
    tcmPreferenceScore,
    identity,
    roast,
    analysis
  };
}</script>
</body>
</html>
